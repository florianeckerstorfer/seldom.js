!function(e,t){"use strict";"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define(["exports","require"],function(){return t()}):e.Seldom=t()}(window,function(){var e=function(e,t,n){this.domlight=e||new Domlight,this.clicklight=t||new Domlight,this.options=this.constructor.defaultOptions;for(var i in n)this.options[i]=n[i]};return e.defaultOptions={},e.prototype.getDeepestElementWithContent=function(e){for(var t=e.textContent,n=e,i=e.childNodes.length-1;i>=0;i--)1===e.childNodes[i].nodeType&&e.childNodes[i].textContent===t&&(n=this.getDeepestElementWithContent(e.childNodes[i]),null===n&&(n=e.childNodes[i]));return n},e.prototype.select=function(e,t){for(var n,i=this,o=e.querySelectorAll("*"),l=function(e){e.target!=n&&(i.domlight.unlight(n),n=e.target,i.domlight.highlight(n))},r=function(e){e.preventDefault(),e.stopPropagation();for(var n=o.length-1;n>=0;n--)o[n].removeEventListener("mousemove",l,!1),o[n].removeEventListener("click",r,!0);i.domlight.unlightAll(o),i.clicklight.unlightAll(o),i.clicklight.highlight(e.target),t(e.target)},d=o.length-1;d>=0;d--){var c=o[d];c.addEventListener("click",r,!0),c.addEventListener("mousemove",l,!1)}},e.prototype.refineSelection=function(e,t){var n=this,i=function(){var t=n.computePosition(e),i=t.y2;i>window.pageYOffset+window.innerHeight-30&&(i=t.y1-35),i<window.pageYOffset&&(i+=35),console.log("top",i),console.log("pageYOffset",window.pageYOffset),console.log("innerHeight",window.innerHeight),p.style.left=t.x1+"px",p.style.top=i+"px"},o=function(t){e=t,i(),u()},l=function(){n.switchDomlight(n.clicklight,e,e.parentNode),o(e.parentNode)},r=function(){e.children[0]&&(n.switchDomlight(n.clicklight,e,e.children[0]),o(e.children[0]))},d=function(){var t=n.prevRealSibling(e);t&&(n.switchDomlight(n.clicklight,e,t),o(t))},c=function(){var t=n.nextRealSibling(e);t&&(n.switchDomlight(n.clicklight,e,t),o(t))},a=function(){document.body.removeChild(p),t(e)},s=function(){var e=document.createElement("div");e.className="seldom__refine-selection";var t=document.createElement("a");t.classList.add("parent"),t.appendChild(document.createTextNode("Parent")),t.addEventListener("click",l);var n=document.createElement("a");n.classList.add("first-child"),n.appendChild(document.createTextNode("First Child")),n.addEventListener("click",r);var i=document.createElement("a");i.classList.add("prev-sibling"),i.appendChild(document.createTextNode("Previous Sibling")),i.addEventListener("click",d);var o=document.createElement("a");o.classList.add("next-sibling"),o.appendChild(document.createTextNode("Next Sibling")),o.addEventListener("click",c);var s=document.createElement("a");return s.classList.add("done"),s.appendChild(document.createTextNode("Done")),s.addEventListener("click",a),e.appendChild(t),e.appendChild(n),e.appendChild(i),e.appendChild(o),e.appendChild(s),e},u=function(){var t=p.querySelector(".next-sibling"),i=p.querySelector(".prev-sibling"),o=p.querySelector(".first-child"),l=p.querySelector(".parent");null===n.nextRealSibling(e)?t.classList.add("inactive"):t.classList.remove("inactive"),null===n.prevRealSibling(e)?i.classList.add("inactive"):i.classList.remove("inactive"),e.children[0]?o.classList.remove("inactive"):o.classList.add("inactive"),e.parentNode?l.classList.remove("inactive"):l.classList.add("inactive")},p=s();i(p),document.body.appendChild(p)},e.prototype.prevRealSibling=function(e){for(var t=e.previousSibling;t&&1!==t.nodeType;)t=t.previousSibling;return t&&1===t.nodeType?t:null},e.prototype.nextRealSibling=function(e){for(var t=e.nextSibling;t&&1!==t.nodeType;)t=t.nextSibling;return t&&1===t.nodeType?t:null},e.prototype.switchDomlight=function(e,t,n){e.unlight(t),e.highlight(n)},e.prototype.computePosition=function(e){var t=document.createRange();t.selectNode(e);var n=t.getBoundingClientRect(),i=window.pageXOffset+n.left,o=window.pageYOffset+n.top;return{x1:i,x2:i+n.width,y1:o,y2:o+n.height}},e.prototype.addEvent=function(e,t,n,i){"undefined"!=typeof e.addEventListener?"mouseenter"===t?e.addEventListener("mouseover",this.mouseEnter(n),i):"mouseleave"===t?e.addEventListener("mouseout",this.mouseEnter(n),i):e.addEventListener(t,n,i):"undefined"!=typeof e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},e.prototype.mouseEnter=function(e){var t=this;return function(n){var i=n.relatedTarget;this===i||t.isChildOf(this,i)||e.call(this,n)}},e.prototype.isChildOf=function(e,t){if(e===t)return!1;for(;t&&t!==e;)t=t.parentNode;return t===e},e});